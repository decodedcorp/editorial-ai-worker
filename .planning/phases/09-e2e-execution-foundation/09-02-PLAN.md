---
phase: 09-e2e-execution-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/seed_sample_data.sql
autonomous: true

must_haves:
  truths:
    - "SQL script is idempotent — uses ON CONFLICT DO NOTHING or IF NOT EXISTS"
    - "posts table has 15+ rows with artist_name, group_name, context, trending_score, status fields populated"
    - "spots table has 20+ rows linked to posts via post_id"
    - "solutions table has 20+ rows with title, metadata (including keywords, qa_pairs JSON), link_type, original_url"
    - "Data covers multiple K-fashion celebs/groups for diverse curation results"
  artifacts:
    - path: "scripts/seed_sample_data.sql"
      provides: "Idempotent sample data for posts, spots, solutions tables"
      contains: "ON CONFLICT"
  key_links:
    - from: "scripts/seed_sample_data.sql"
      to: "src/editorial_ai/services/curation_service.py"
      via: "posts/solutions data queried by curation and source nodes"
      pattern: "INSERT INTO posts"
---

<objective>
Create a sample data SQL seed script with realistic K-fashion data for posts, spots, and solutions tables.

Purpose: Enable meaningful E2E pipeline execution on fresh or empty databases. The pipeline queries posts -> spots -> solutions for celeb fashion content, so seed data must populate these tables with realistic Korean fashion/celeb data.
Output: Idempotent SQL script at scripts/seed_sample_data.sql
</objective>

<execution_context>
@/Users/kiyeol/.claude-pers/get-shit-done/workflows/execute-plan.md
@/Users/kiyeol/.claude-pers/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/09-e2e-execution-foundation/09-RESEARCH.md

@src/editorial_ai/services/curation_service.py
@src/editorial_ai/nodes/source.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sample data SQL seed script</name>
  <files>
    scripts/seed_sample_data.sql
  </files>
  <action>
Create `scripts/seed_sample_data.sql` with realistic K-fashion sample data. The script must be:
- **Idempotent**: Use `INSERT ... ON CONFLICT (id) DO NOTHING` for all inserts
- **Self-contained**: Include brief comments explaining purpose and usage
- **Realistic**: Use actual K-pop group/artist names, fashion brands, and plausible image URLs

**Header comment:**
```sql
-- Seed sample data for E2E pipeline testing
-- Usage: psql $DATABASE_URL -f scripts/seed_sample_data.sql
-- Or: Run via Supabase SQL Editor
-- Idempotent: safe to run multiple times (ON CONFLICT DO NOTHING)
```

**Data requirements (from research — the pipeline queries posts -> spots -> solutions):**

1. **posts** (15-20 rows):
   - Required fields: `id` (uuid or text), `image_url`, `media_type`, `title`, `artist_name`, `group_name`, `context`, `view_count` (integer), `trending_score` (integer/float), `status` (text, 'active')
   - Cover 4-5 K-pop groups: NewJeans, aespa, BLACKPINK, IVE, LE SSERAFIM
   - Mix of contexts: fashion week, airport fashion, music show, magazine shoot, brand event
   - Use placeholder image URLs like `https://images.example.com/posts/{id}.jpg` (not real URLs — these are for testing)
   - trending_score range: 50-100
   - view_count range: 5000-50000

2. **spots** (25-30 rows):
   - Required fields: `id` (uuid or text), `post_id` (FK to posts.id)
   - Each post should have 1-3 spots (fashion items spotted in the post)
   - Use UUID-like text IDs: `spot-001`, `spot-002`, etc.

3. **solutions** (25-30 rows):
   - Required fields: `id` (uuid or text), `title`, `thumbnail_url`, `metadata` (JSONB), `link_type`, `original_url`
   - `metadata` must contain `keywords` (array of strings) and `qa_pairs` (array of {question, answer} objects) — these are what the pipeline extracts
   - `link_type`: 'product', 'brand', 'reference'
   - Cover luxury brands: Gucci, Chanel, Dior, Miu Miu, Prada, Celine, Saint Laurent
   - Cover K-fashion brands: Ader Error, Andersson Bell, Gentle Monster, Thom Browne
   - Items: bags, jackets, sunglasses, shoes, dresses, jewelry
   - Solutions should link to spots via a spot_id column if the schema has it; if not, they stand alone. Check the source code — `source_node` joins solutions via spots. Include a `spot_id` field referencing the spots.

   Example metadata JSON:
   ```json
   {
     "keywords": ["Gucci", "bag", "Jackie"],
     "qa_pairs": [
       {"question": "What brand is this?", "answer": "Gucci"},
       {"question": "What is the product?", "answer": "Jackie 1961 mini shoulder bag"}
     ]
   }
   ```

4. **Optional: celebs** (10-15 rows) and **products** (15-20 rows):
   - These aren't used by the main pipeline flow (posts->spots->solutions is the active path)
   - But include them for completeness and future use (enrich_node uses them)
   - celebs: `id`, `name`, `name_en`, `category`, `profile_image_url`, `description`, `tags` (JSONB array)
   - products: `id`, `name`, `brand`, `category`, `price` (integer), `image_url`, `description`, `product_url`, `tags` (JSONB array)

**Important notes:**
- Use text/varchar IDs (not auto-increment) so ON CONFLICT works reliably
- For UUID fields, use deterministic UUIDs like `'00000000-0000-0000-0000-000000000001'` or simple text IDs like `'post-001'`
- Check actual table schemas by reading the Supabase migration files at `supabase/migrations/` if they exist, or infer from the Pydantic models in `src/editorial_ai/models/`
- If tables don't exist yet, do NOT include CREATE TABLE — the health check (Plan 01) will detect missing tables. The seed script assumes tables exist.
  </action>
  <verify>
    cd /Users/kiyeol/development/decoded/editorial-ai-worker && test -f scripts/seed_sample_data.sql && echo "File exists" && wc -l scripts/seed_sample_data.sql && grep -c "INSERT INTO posts" scripts/seed_sample_data.sql && grep -c "INSERT INTO spots" scripts/seed_sample_data.sql && grep -c "INSERT INTO solutions" scripts/seed_sample_data.sql && grep -c "ON CONFLICT" scripts/seed_sample_data.sql
  </verify>
  <done>scripts/seed_sample_data.sql exists with 15+ posts, 25+ spots, 25+ solutions covering multiple K-pop groups and fashion brands, all using ON CONFLICT DO NOTHING for idempotency</done>
</task>

</tasks>

<verification>
- `scripts/seed_sample_data.sql` exists and is valid SQL (no syntax errors in basic review)
- File contains INSERT statements for posts, spots, solutions
- All INSERTs use ON CONFLICT DO NOTHING
- Data covers diverse K-pop groups and fashion brands
- metadata JSONB fields contain keywords and qa_pairs arrays
- Script header includes usage instructions
</verification>

<success_criteria>
- Idempotent SQL seed script provides realistic K-fashion data
- posts (15+), spots (25+), solutions (25+) with proper FK relationships
- Data enables meaningful pipeline execution (curation can find trending celebs, source can find products)
- Script can be run via psql or Supabase SQL Editor
</success_criteria>

<output>
After completion, create `.planning/phases/09-e2e-execution-foundation/09-02-SUMMARY.md`
</output>
