---
phase: 14-magazine-layout-variants
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - admin/src/components/blocks/hero-block.tsx
  - admin/src/components/blocks/body-text-block.tsx
  - admin/src/components/blocks/image-gallery-block.tsx
autonomous: true

must_haves:
  truths:
    - "Hero block renders 6 distinct visual layouts based on layout_variant"
    - "Body text block renders 6 distinct layouts including multi-column and drop cap accent"
    - "Image gallery renders 8 distinct layouts including full-bleed and filmstrip"
    - "All blocks fall back to current rendering when layout_variant is undefined/null"
  artifacts:
    - path: "admin/src/components/blocks/hero-block.tsx"
      provides: "6 hero variants: contained, full_bleed, split_text_left, split_text_right, parallax, letterbox"
      contains: "layout_variant"
    - path: "admin/src/components/blocks/body-text-block.tsx"
      provides: "6 body text variants: single_column, two_column, three_column, wide, narrow_centered, drop_cap_accent"
      contains: "layout_variant"
    - path: "admin/src/components/blocks/image-gallery-block.tsx"
      provides: "8 gallery variants: grid, carousel, masonry, full_bleed_grid, asymmetric, full_bleed_single, staggered_overlap, filmstrip"
      contains: "layout_variant"
  key_links:
    - from: "admin/src/components/blocks/hero-block.tsx"
      to: "admin/src/lib/types.ts"
      via: "HeroBlock.layout_variant type"
      pattern: "block\\.layout_variant"
    - from: "admin/src/components/blocks/image-gallery-block.tsx"
      to: "admin/src/lib/types.ts"
      via: "ImageGalleryBlock.layout_variant type with layout_style fallback"
      pattern: "layout_variant.*layout_style"
---

<objective>
Implement layout variant rendering for the 3 most visually impactful blocks: hero, body_text, and image_gallery.

Purpose: These blocks define the visual character of the magazine. Hero sets the tone, body_text controls reading flow, image_gallery showcases visual content.
Output: Three fully variant-aware block components.
</objective>

<execution_context>
@/Users/kiyeol/.claude-pers/get-shit-done/workflows/execute-plan.md
@/Users/kiyeol/.claude-pers/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/14-magazine-layout-variants/14-01-SUMMARY.md
@admin/src/lib/types.ts
@admin/src/components/blocks/hero-block.tsx
@admin/src/components/blocks/body-text-block.tsx
@admin/src/components/blocks/image-gallery-block.tsx
@admin/src/components/magazine-image.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Hero block — 6 layout variants</name>
  <files>admin/src/components/blocks/hero-block.tsx</files>
  <action>
Refactor HeroBlockComponent to branch on `block.layout_variant`. Read the current code first, then rewrite to support all 6 variants.

**Variant implementations:**

1. **`contained`** (default/current behavior when variant is null/undefined/"contained"):
   Keep current code exactly as-is: `relative w-full overflow-hidden rounded-lg` with MagazineImage + overlay.

2. **`full_bleed`**:
   - Remove rounded-lg, use `relative w-full overflow-hidden`
   - Set min-height: `min-h-[90vh]`
   - Image fills container with object-cover
   - Overlay text at bottom, larger: `text-5xl md:text-7xl`

3. **`split_text_left`**:
   - Two-column grid: `grid grid-cols-1 md:grid-cols-2 min-h-[70vh]`
   - Left column: dark background (use designSpec primary or `bg-gray-900`), vertically centered text, padding p-8 md:p-12
   - Title: `text-3xl md:text-5xl font-bold text-white`, subtitle below
   - Right column: MagazineImage filling full height, `aspect-auto h-full object-cover`

4. **`split_text_right`**:
   - Same as split_text_left but reversed: image left, text right
   - Use `md:order-1` / `md:order-2` or reverse grid column order

5. **`parallax`**:
   - Full width, `min-h-[85vh]`, `bg-fixed bg-center bg-cover` on a div with inline style backgroundImage
   - Since we use MagazineImage (which handles broken images), use MagazineImage with `object-cover` inside a sticky/fixed-feel container
   - Actually: use `relative w-full min-h-[85vh] overflow-hidden` with the image absolutely positioned and the CSS `will-change: transform` for smooth scroll
   - Overlay centered vertically and horizontally, text `text-5xl md:text-7xl font-bold text-white`

6. **`letterbox`**:
   - `relative w-full overflow-hidden` with forced aspect ratio `aspect-[21/9]`
   - Image cropped to cinematic ratio
   - Overlay text at center: `text-4xl md:text-6xl font-bold text-white tracking-wider uppercase`

**Important:** When variant is null/undefined, use `contained` behavior (identical to current).

Use a switch/if-else on `block.layout_variant ?? "contained"` to branch rendering.
  </action>
  <verify>Run `cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && npx tsc --noEmit` -- zero errors.</verify>
  <done>HeroBlockComponent renders 6 distinct layouts. Null/undefined variant renders identically to current code.</done>
</task>

<task type="auto">
  <name>Task 2: Body text block — 6 layout variants</name>
  <files>admin/src/components/blocks/body-text-block.tsx</files>
  <action>
Refactor BodyTextBlockComponent to branch on `block.layout_variant`.

**Variant implementations:**

1. **`single_column`** (default/current when variant is null/undefined):
   Keep current code exactly. Standard paragraphs with optional drop cap from designSpec.

2. **`two_column`**:
   - Wrap paragraphs in `<div className="columns-2 gap-8">`
   - Each paragraph: same styling as current but inside column flow
   - Drop cap still applies to first paragraph

3. **`three_column`**:
   - `columns-3 gap-6` (collapses to columns-1 on mobile, columns-2 on md)
   - Use responsive: `columns-1 md:columns-2 lg:columns-3 gap-6`

4. **`wide`**:
   - No structural change to paragraphs (width handled by BlockRenderer wrapper)
   - Add slightly larger line-height: `leading-[2]` instead of `leading-[1.8]`
   - Slightly larger text: `text-lg` instead of `text-[17px]`

5. **`narrow_centered`**:
   - No structural change (width handled by BlockRenderer wrapper at max-w-xl)
   - Add `text-center` to paragraphs for elegant centered reading
   - Use `text-lg leading-[2]` for more spacious feel

6. **`drop_cap_accent`**:
   - Always show drop cap regardless of designSpec.drop_cap setting
   - Oversized drop cap: `text-[5rem] leading-[0.7]` (bigger than current 3.5rem)
   - Use accent color from designSpec for drop cap
   - Add a decorative left border on first paragraph: `border-l-2` with accent color

**Important:** When variant is null/undefined, use `single_column` (identical to current).
  </action>
  <verify>Run `cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && npx tsc --noEmit` -- zero errors.</verify>
  <done>BodyTextBlockComponent renders 6 layouts. Null/undefined variant renders identically to current code.</done>
</task>

<task type="auto">
  <name>Task 3: Image gallery block — 8 layout variants</name>
  <files>admin/src/components/blocks/image-gallery-block.tsx</files>
  <action>
Refactor ImageGalleryBlockComponent to support layout_variant. When `layout_variant` is null/undefined, fall back to `block.layout_style` for backward compatibility with existing "grid"/"carousel"/"masonry" values.

**Variant resolution logic:**
```typescript
const variant = block.layout_variant ?? block.layout_style ?? "grid";
```

**Variant implementations:**

1. **`grid`** (default): Current grid behavior. `grid grid-cols-2 gap-4`.

2. **`carousel`**: Current carousel. `flex gap-4 overflow-x-auto pb-2`, items `flex-none w-64`.

3. **`masonry`**: Current masonry. `columns-2 gap-4 space-y-4`.

4. **`full_bleed_grid`**:
   - `grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1`
   - Minimal gap (gap-1), no rounded corners
   - Images: `aspect-square object-cover`
   - No captions (clean grid look)

5. **`asymmetric`**:
   - First image large (spans 2 rows or full width), rest smaller
   - Layout: `grid grid-cols-2 gap-3`
   - First item: `col-span-2` with `aspect-[16/10]`
   - Remaining items: `aspect-square`

6. **`full_bleed_single`**:
   - Each image gets full width, stacked vertically
   - `flex flex-col gap-0` (or small gap-2)
   - Each image: `w-full aspect-[16/9]`
   - Show captions below each image if present

7. **`staggered_overlap`**:
   - Collage-style with CSS transforms for overlap effect
   - `relative` container with images positioned using negative margins
   - First image: `w-[70%]`, second: `w-[55%] ml-auto -mt-16`, third: `w-[60%] -mt-12`
   - Use `relative z-[index]` to stack properly
   - Add `shadow-xl rounded-sm` to each for depth

8. **`filmstrip`**:
   - Horizontal strip with cinematic ratio
   - `flex gap-2 overflow-x-auto pb-3`
   - Each item: `flex-none w-[40vw] md:w-[30vw]` with `aspect-[21/9]`
   - Add thin white border for film-frame feel: `border-2 border-white`

**Important:** Backward compat: when layout_variant is null, use layout_style value.
  </action>
  <verify>Run `cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && npx tsc --noEmit` -- zero errors.</verify>
  <done>ImageGalleryBlockComponent renders 8 layouts. Null layout_variant falls back to layout_style for backward compatibility.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in admin/
2. Each component has a clear branch for every documented variant
3. Null/undefined layout_variant produces identical output to current code
</verification>

<success_criteria>
- Hero: 6 variants rendering distinct layouts (full_bleed = 90vh, split = 50/50 grid, parallax = scroll effect, letterbox = 21:9)
- Body text: 6 variants (columns, width variations, enhanced drop cap)
- Image gallery: 8 variants with layout_style backward compat
- All backward compatible when layout_variant is null/undefined
</success_criteria>

<output>
After completion, create `.planning/phases/14-magazine-layout-variants/14-02-SUMMARY.md`
</output>
