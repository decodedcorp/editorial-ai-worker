---
phase: 14-magazine-layout-variants
plan: 04
type: execute
wave: 3
depends_on: ["14-02", "14-03"]
files_modified:
  - admin/src/components/blocks/divider-block.tsx
  - admin/src/components/blocks/hashtag-bar-block.tsx
  - admin/src/components/blocks/credits-block.tsx
  - src/editorial_ai/prompts/editorial.py
autonomous: true

must_haves:
  truths:
    - "Divider renders 6 distinct visual separators"
    - "Hashtag bar renders 4 distinct layouts"
    - "Credits renders 4 distinct layouts"
    - "AI prompt instructs Gemini to select layout_variant per block"
    - "AI prompt lists all valid variants per block type"
    - "All blocks fall back to current rendering when layout_variant is undefined/null"
  artifacts:
    - path: "admin/src/components/blocks/divider-block.tsx"
      provides: "6 divider variants"
      contains: "layout_variant"
    - path: "admin/src/components/blocks/hashtag-bar-block.tsx"
      provides: "4 hashtag bar variants"
      contains: "layout_variant"
    - path: "admin/src/components/blocks/credits-block.tsx"
      provides: "4 credits variants"
      contains: "layout_variant"
    - path: "src/editorial_ai/prompts/editorial.py"
      provides: "Updated layout parsing prompt with layout_variant selection"
      contains: "layout_variant"
  key_links:
    - from: "src/editorial_ai/prompts/editorial.py"
      to: "src/editorial_ai/models/layout.py"
      via: "Prompt variant names match model Literal values exactly"
      pattern: "layout_variant"
    - from: "src/editorial_ai/prompts/editorial.py"
      to: "admin/src/components/blocks/*.tsx"
      via: "AI-selected variants rendered by frontend components"
      pattern: "layout_variant"
---

<objective>
Implement layout variants for utility blocks (divider, hashtag_bar, credits) and update AI prompts so Gemini selects layout_variant for each block.

Purpose: Completes the layout variant system. Utility blocks get visual variety, and the AI prompt enables Gemini to choose variants automatically during content generation.
Output: Three variant-aware utility components + updated AI prompt.
</objective>

<execution_context>
@/Users/kiyeol/.claude-pers/get-shit-done/workflows/execute-plan.md
@/Users/kiyeol/.claude-pers/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/14-magazine-layout-variants/14-01-SUMMARY.md
@admin/src/lib/types.ts
@admin/src/components/blocks/divider-block.tsx
@admin/src/components/blocks/hashtag-bar-block.tsx
@admin/src/components/blocks/credits-block.tsx
@src/editorial_ai/prompts/editorial.py
@src/editorial_ai/models/layout.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Divider (6), Hashtag bar (4), Credits (4) variants</name>
  <files>admin/src/components/blocks/divider-block.tsx, admin/src/components/blocks/hashtag-bar-block.tsx, admin/src/components/blocks/credits-block.tsx</files>
  <action>
**Divider variants** -- branch on `block.layout_variant ?? block.style ?? "line"`:

Note: DividerBlock has existing `style` field ("line"/"space"/"ornament"). When layout_variant is null, fall back to `block.style` for backward compat.

1. **`line`** (default): Current `<hr className="border-t border-gray-200" />`.
2. **`space`**: Current `<div className="h-12" />`.
3. **`ornament`**: Current centered dots.
4. **`full_bleed_line`**: Full-width thin line: `<hr className="border-t border-gray-300 w-full" />`. No max-width constraint (BlockRenderer handles width).
5. **`color_band`**: Colored strip using designSpec accent: `<div className="h-2 w-full" style={{ backgroundColor: accentColor }} />`. Falls back to `bg-gray-200` without designSpec.
6. **`gradient_fade`**: Gradient transition strip: `<div className="h-16 w-full bg-gradient-to-b from-transparent via-gray-100 to-transparent" />`. Subtle section transition effect.

**Hashtag bar variants** -- branch on `block.layout_variant ?? "default"`:

1. **`default`** (current): Current flex-wrap pills with rounded-full border.
2. **`full_width_banner`**: Full-width colored background strip.
   - `py-6 px-8` with background color (designSpec accent + low opacity or `bg-gray-100`)
   - Tags centered: `flex flex-wrap justify-center gap-3`
   - Tags: `text-sm font-medium` without border (clean on colored bg)
3. **`minimal_inline`**: Plain text inline, no pills.
   - `text-sm text-gray-500`
   - Tags joined with ` / ` separator
   - Simple, editorial footer feel
4. **`floating`**: Tag cloud with varied sizes.
   - `flex flex-wrap justify-center gap-4 py-6`
   - Vary font sizes pseudo-randomly: use index to cycle through `text-xs`, `text-sm`, `text-base`, `text-lg`
   - `opacity-70` to `opacity-100` variation
   - No borders, just floating text

**Credits variants** -- branch on `block.layout_variant ?? "default"`:

1. **`default`** (current): Current border-top with grid layout.
2. **`full_width_footer`**: Dark background full-width footer.
   - `bg-gray-900 text-white py-10 px-8`
   - `Credits` label: `text-gray-400`
   - Grid of entries: `grid gap-4 sm:grid-cols-2 md:grid-cols-3`
   - Role: `text-gray-500 text-[10px] uppercase tracking-[0.15em]`
   - Name: `text-gray-200 text-sm`
3. **`inline`**: Single line, compact.
   - All entries joined inline: `text-xs text-gray-400`
   - Format: "Role: Name / Role: Name / ..."
   - Centered, `text-center`
4. **`sidebar_column`**: Narrow right-aligned column.
   - `ml-auto max-w-[200px] text-right`
   - Each entry stacked vertically
   - Small text: `text-[10px]` role, `text-xs` name
   - Subtle and unobtrusive
  </action>
  <verify>Run `cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && npx tsc --noEmit` -- zero errors.</verify>
  <done>Divider has 6 variants (backward compat via style field fallback). Hashtag bar has 4 variants. Credits has 4 variants.</done>
</task>

<task type="auto">
  <name>Task 2: Update AI prompt to select layout_variant per block</name>
  <files>src/editorial_ai/prompts/editorial.py</files>
  <action>
Update `build_layout_parsing_prompt` in editorial.py to instruct Gemini Vision to also select a `layout_variant` for each block.

Modify the prompt to add layout_variant to the output format and provide the complete variant list.

**Changes to `build_layout_parsing_prompt`:**

1. Add layout_variant to the output format example:
```json
[
  {"type": "hero", "order": 0, "animation": "parallax", "layout_variant": "full_bleed"},
  {"type": "headline", "order": 1, "animation": "fade-up", "layout_variant": "default"},
  ...
]
```

2. Add a layout_variant guide section (after the animation guide):
```
레이아웃 변형 가이드 (블록 타입별 사용 가능한 layout_variant):
- hero: "contained" (기본), "full_bleed" (100vw, 90vh), "split_text_left" (50/50 텍스트+이미지), "split_text_right", "parallax" (패럴랙스 스크롤), "letterbox" (21:9 시네마틱)
- headline: "default" (기본), "full_width_banner" (풀폭 컬러 배너), "left_aligned_large" (8xl+ 좌정렬), "overlapping" (반투명 겹침)
- body_text: "single_column" (기본), "two_column" (2단), "three_column" (3단), "wide" (넓은), "narrow_centered" (좁은 중앙), "drop_cap_accent" (장식 드롭캡)
- image_gallery: "grid" (기본), "carousel", "masonry", "full_bleed_grid" (풀폭 그리드), "asymmetric" (비대칭), "full_bleed_single" (풀폭 단일), "staggered_overlap" (콜라주), "filmstrip" (필름스트립)
- pull_quote: "default" (기본), "centered_large" (큰 중앙정렬), "full_width_background" (컬러 배경), "sidebar" (사이드바), "oversized_serif" (대형 세리프)
- product_showcase: "grid" (기본), "full_width_row" (가로 풀폭), "featured_plus_grid" (히어로+그리드), "minimal_list" (텍스트 리스트), "lookbook" (룩북), "carousel_cards" (가로 스크롤)
- celeb_feature: "grid" (기본), "spotlight" (스포트라이트), "card_row" (카드), "minimal_list" (리스트), "hero_collage" (콜라주)
- divider: "line" (기본), "space", "ornament", "full_bleed_line" (풀폭 라인), "color_band" (컬러 밴드), "gradient_fade" (그라데이션)
- hashtag_bar: "default" (기본), "full_width_banner" (풀폭 배너), "minimal_inline" (인라인), "floating" (태그 클라우드)
- credits: "default" (기본), "full_width_footer" (다크 풋터), "inline" (인라인), "sidebar_column" (사이드바)
```

3. Add layout_variant selection rules:
```
레이아웃 변형 선택 규칙:
- 매거진 전체에서 다양한 레이아웃을 사용하세요 (모든 블록이 "default"이면 안 됩니다)
- hero는 "full_bleed" 또는 "parallax"를 권장 (임팩트 있는 시작)
- body_text가 2개 이상이면 서로 다른 variant를 사용하세요
- 풀폭 블록(full_bleed, full_width 계열)은 2-3개로 제한하여 리듬감 유지
- credits는 "full_width_footer"를 권장 (매거진 마무리 느낌)
```

4. Update the rules section to mention layout_variant is required:
```
- layout_variant는 각 블록 타입에 맞는 값 중 하나 (필수)
```

**Do NOT change** the other prompt functions (build_content_generation_prompt, etc.).
  </action>
  <verify>
Run `cd /Users/kiyeol/development/decoded/editorial-ai-worker && python -c "from editorial_ai.prompts.editorial import build_layout_parsing_prompt; p = build_layout_parsing_prompt('test', ['hero','headline']); assert 'layout_variant' in p; print('OK')"` -- prints OK.
  </verify>
  <done>AI prompt includes complete layout_variant guide. Gemini will select variants per block. Variant names in prompt match Python model Literal values exactly.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in admin/
2. Python imports: `python -c "from editorial_ai.prompts.editorial import *; print('OK')"`
3. Prompt contains all variant names matching layout.py Literal types
4. All 10 block components handle layout_variant with backward-compatible defaults
</verification>

<success_criteria>
- Divider: 6 variants with style field backward compat
- Hashtag bar: 4 variants
- Credits: 4 variants
- AI prompt lists all variants per block type in Korean
- AI prompt instructs diverse variant selection (not all default)
- Prompt variant names exactly match Python model Literal values
- Complete layout variant system: 10 blocks, 54 total variants, AI-selected
</success_criteria>

<output>
After completion, create `.planning/phases/14-magazine-layout-variants/14-04-SUMMARY.md`
</output>
