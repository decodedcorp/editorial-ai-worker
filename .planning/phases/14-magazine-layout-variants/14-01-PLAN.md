---
phase: 14-magazine-layout-variants
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/editorial_ai/models/layout.py
  - admin/src/lib/types.ts
  - admin/src/components/block-renderer.tsx
autonomous: true

must_haves:
  truths:
    - "Every block model has an optional layout_variant field with Literal type"
    - "TypeScript types mirror Python models exactly for layout_variant"
    - "BlockRenderer article container is w-full, not max-w-3xl"
    - "Existing content without layout_variant renders identically to before"
  artifacts:
    - path: "src/editorial_ai/models/layout.py"
      provides: "layout_variant Literal fields on all 10 block models"
      contains: "layout_variant"
    - path: "admin/src/lib/types.ts"
      provides: "layout_variant union types on all 10 block interfaces"
      contains: "layout_variant"
    - path: "admin/src/components/block-renderer.tsx"
      provides: "w-full article container, per-block width wrapper"
      contains: "w-full"
  key_links:
    - from: "src/editorial_ai/models/layout.py"
      to: "admin/src/lib/types.ts"
      via: "Identical layout_variant Literal values"
      pattern: "layout_variant"
    - from: "admin/src/components/block-renderer.tsx"
      to: "admin/src/components/blocks/*.tsx"
      via: "Passes block with layout_variant to each component"
      pattern: "layout_variant"
---

<objective>
Add layout_variant field to all Python and TypeScript block models, and restructure BlockRenderer so each block controls its own width.

Purpose: Foundation for all layout variant rendering. Without this, no block component can branch on layout_variant.
Output: Updated schema models (Python + TS), restructured BlockRenderer container.
</objective>

<execution_context>
@/Users/kiyeol/.claude-pers/get-shit-done/workflows/execute-plan.md
@/Users/kiyeol/.claude-pers/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@src/editorial_ai/models/layout.py
@admin/src/lib/types.ts
@admin/src/components/block-renderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add layout_variant to all Python block models</name>
  <files>src/editorial_ai/models/layout.py</files>
  <action>
Add an optional `layout_variant` field to each of the 10 block models. Use Literal types with the exact variants listed below. Default is always the first variant (the current behavior).

```python
# Add these Literal types ABOVE the block models:

HeroVariant = Literal["contained", "full_bleed", "split_text_left", "split_text_right", "parallax", "letterbox"]
HeadlineVariant = Literal["default", "full_width_banner", "left_aligned_large", "overlapping"]
BodyTextVariant = Literal["single_column", "two_column", "three_column", "wide", "narrow_centered", "drop_cap_accent"]
ImageGalleryVariant = Literal["grid", "carousel", "masonry", "full_bleed_grid", "asymmetric", "full_bleed_single", "staggered_overlap", "filmstrip"]
PullQuoteVariant = Literal["default", "centered_large", "full_width_background", "sidebar", "oversized_serif"]
ProductShowcaseVariant = Literal["grid", "full_width_row", "featured_plus_grid", "minimal_list", "lookbook", "carousel_cards"]
CelebFeatureVariant = Literal["grid", "spotlight", "card_row", "minimal_list", "hero_collage"]
DividerVariant = Literal["line", "space", "ornament", "full_bleed_line", "color_band", "gradient_fade"]
HashtagBarVariant = Literal["default", "full_width_banner", "minimal_inline", "floating"]
CreditsVariant = Literal["default", "full_width_footer", "inline", "sidebar_column"]
```

Then add to each block model:
```python
layout_variant: Optional[XxxVariant] = None
```

For ImageGalleryBlock, note it already has `layout_style` for grid/carousel/masonry. The new `layout_variant` field adds NEW variants (full_bleed_grid, asymmetric, etc.) while keeping `layout_style` for backward compat. When `layout_variant` is None, fall back to `layout_style`.

Also update `create_default_template` -- no changes needed since layout_variant defaults to None.
  </action>
  <verify>
Run `cd /Users/kiyeol/development/decoded/editorial-ai-worker && python -c "from editorial_ai.models.layout import MagazineLayout, HeroBlock; h = HeroBlock(image_url='x'); print(h.layout_variant); h2 = HeroBlock(image_url='x', layout_variant='full_bleed'); print(h2.layout_variant)"` -- should print None then full_bleed.
  </verify>
  <done>All 10 block models have optional layout_variant with correct Literal types. Existing code without layout_variant continues to work (None default).</done>
</task>

<task type="auto">
  <name>Task 2: Add layout_variant to TypeScript types and restructure BlockRenderer</name>
  <files>admin/src/lib/types.ts, admin/src/components/block-renderer.tsx</files>
  <action>
**types.ts changes:**

Add layout_variant to each block interface, mirroring the Python Literal types exactly:

```typescript
export interface HeroBlock {
  type: "hero";
  image_url: string;
  overlay_title?: string | null;
  overlay_subtitle?: string | null;
  animation?: AnimationType | null;
  layout_variant?: "contained" | "full_bleed" | "split_text_left" | "split_text_right" | "parallax" | "letterbox" | null;
}
```

Do this for ALL 10 block interfaces with their respective variant unions.

**block-renderer.tsx changes:**

1. Change `<article className="mx-auto max-w-3xl space-y-8 py-8">` to `<article className="w-full space-y-8 py-8">`.

2. Add a helper function that determines wrapper class based on block type and layout_variant:

```typescript
function getBlockWidthClass(block: LayoutBlock): string {
  const variant = (block as { layout_variant?: string | null }).layout_variant;

  // Full-bleed variants get no width constraint
  const fullBleedVariants = new Set([
    "full_bleed", "parallax", "letterbox", "split_text_left", "split_text_right",
    "full_width_banner", "full_bleed_grid", "full_bleed_single", "staggered_overlap",
    "full_width_background", "full_width_row", "lookbook",
    "hero_collage", "full_bleed_line", "color_band", "gradient_fade",
    "full_width_footer", "floating",
  ]);

  // Wide variants get max-w-5xl
  const wideVariants = new Set([
    "wide", "featured_plus_grid", "carousel_cards", "card_row", "filmstrip",
    "centered_large", "oversized_serif", "spotlight",
  ]);

  // Narrow variant
  if (variant === "narrow_centered") return "max-w-xl mx-auto";
  if (variant === "sidebar_column") return "max-w-3xl mx-auto";
  if (variant && fullBleedVariants.has(variant)) return "w-full";
  if (variant && wideVariants.has(variant)) return "max-w-5xl mx-auto";

  // Default: same as before (max-w-3xl centered)
  return "max-w-3xl mx-auto";
}
```

3. Wrap each block in a div with the computed width class:

```tsx
<div className={getBlockWidthClass(block)}>
  <BlockErrorBoundary key={i} blockType={type!} blockData={block}>
    <AnimatedBlock index={i} animation={blockAnimation}>
      <Component block={block} designSpec={designSpec ?? undefined} />
    </AnimatedBlock>
  </BlockErrorBoundary>
</div>
```

This ensures backward compatibility: blocks without layout_variant get `max-w-3xl mx-auto` (identical to current behavior).
  </action>
  <verify>
Run `cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && npx tsc --noEmit` -- should pass with zero errors.
  </verify>
  <done>TypeScript types mirror Python models. BlockRenderer article is w-full. Each block gets width wrapper based on layout_variant. Blocks without layout_variant render at max-w-3xl (backward compatible).</done>
</task>

</tasks>

<verification>
1. Python: `python -c "from editorial_ai.models.layout import *; print('OK')"` -- imports clean
2. Python: Create a HeroBlock with layout_variant="full_bleed" and one without -- both valid
3. TypeScript: `npx tsc --noEmit` passes
4. Visual: Existing content renders identically (no layout_variant = max-w-3xl default)
</verification>

<success_criteria>
- All 10 Python block models have layout_variant with correct Literal types
- All 10 TypeScript block interfaces have matching layout_variant unions
- BlockRenderer uses w-full container with per-block width wrappers
- Existing content without layout_variant renders exactly as before
</success_criteria>

<output>
After completion, create `.planning/phases/14-magazine-layout-variants/14-01-SUMMARY.md`
</output>
