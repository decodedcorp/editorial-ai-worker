---
phase: 08-admin-dashboard-ui
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - admin/src/app/contents/[id]/page.tsx
  - admin/src/app/contents/[id]/actions.tsx
  - admin/src/components/sticky-action-bar.tsx
  - admin/src/components/reject-form.tsx
autonomous: false

must_haves:
  truths:
    - "Sticky top bar on detail page shows Back button, status badge, and Approve/Reject buttons"
    - "Clicking Approve sends POST to /api/contents/{id}/approve and updates status badge to Approved"
    - "Clicking Reject expands inline textarea for rejection reason, then Confirm Reject sends POST to /api/contents/{id}/reject"
    - "After approve/reject, action buttons are disabled and status badge updates in-place"
    - "Approve button shows loading spinner during API call"
    - "Only pending content shows active Approve/Reject buttons"
  artifacts:
    - path: "admin/src/app/contents/[id]/actions.tsx"
      provides: "Client Component with approve/reject mutation logic"
      contains: "use client"
    - path: "admin/src/components/sticky-action-bar.tsx"
      provides: "Sticky top bar with back button, status, and action buttons"
      contains: "StickyActionBar"
    - path: "admin/src/components/reject-form.tsx"
      provides: "Inline rejection reason textarea with Cancel/Confirm"
      contains: "RejectForm"
  key_links:
    - from: "admin/src/app/contents/[id]/actions.tsx"
      to: "admin/src/app/api/contents/[id]/approve/route.ts"
      via: "fetch POST to /api/contents/{id}/approve"
      pattern: "fetch.*approve"
    - from: "admin/src/app/contents/[id]/actions.tsx"
      to: "admin/src/app/api/contents/[id]/reject/route.ts"
      via: "fetch POST to /api/contents/{id}/reject"
      pattern: "fetch.*reject"
    - from: "admin/src/app/contents/[id]/page.tsx"
      to: "admin/src/app/contents/[id]/actions.tsx"
      via: "Server Component renders Client Component for mutations"
      pattern: "ActionBar"
---

<objective>
Wire up the approve/reject flow on the content detail page with sticky action bar, optimistic UI, and inline rejection form.

Purpose: This is the final piece -- the admin can now take action on content. The sticky top bar ensures approve/reject buttons are always visible while scrolling through the preview. Optimistic UI updates the status badge immediately so the admin gets instant feedback, even though the backend graph.ainvoke may take a few seconds.
Output: Interactive detail page with working approve/reject buttons, loading states, inline reject form
</objective>

<execution_context>
@/Users/kiyeol/.claude-pers/get-shit-done/workflows/execute-plan.md
@/Users/kiyeol/.claude-pers/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-admin-dashboard-ui/08-RESEARCH.md
@.planning/phases/08-admin-dashboard-ui/08-02-SUMMARY.md

@admin/src/app/contents/[id]/page.tsx
@admin/src/lib/types.ts
@admin/src/components/content-status-badge.tsx
@src/editorial_ai/api/routes/admin.py
@src/editorial_ai/api/schemas.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Sticky action bar with approve/reject flow</name>
  <files>
    admin/src/components/sticky-action-bar.tsx
    admin/src/components/reject-form.tsx
    admin/src/app/contents/[id]/actions.tsx
    admin/src/app/contents/[id]/page.tsx
  </files>
  <action>
1. Create `admin/src/components/reject-form.tsx` as a Client Component (`'use client'`):
   - Props: `{ onConfirm: (reason: string) => void, onCancel: () => void, isLoading: boolean }`
   - Renders an inline form (not a modal) that appears below the action bar:
     - shadcn Textarea for rejection reason, placeholder "Enter rejection reason..."
     - Two buttons: "Cancel" (variant ghost, calls onCancel) and "Confirm Reject" (variant destructive, calls onConfirm with textarea value)
     - "Confirm Reject" is disabled when textarea is empty or isLoading is true
     - Show subtle animation on mount (e.g., slide-down with `animate-in` or simple opacity transition)
   - Textarea value managed with local `useState`

2. Create `admin/src/components/sticky-action-bar.tsx` -- this is a presentational component (no logic):
   - Props: `{ children: React.ReactNode }` (receives action buttons as children)
   - Renders a sticky top bar: `sticky top-0 z-50 bg-white/95 backdrop-blur border-b`
   - Inner container: flex row with items-center gap-4, padded (px-6 py-3)
   - Just a layout wrapper -- all interactive logic lives in actions.tsx

3. Create `admin/src/app/contents/[id]/actions.tsx` as a Client Component (`'use client'`):
   - Props: `{ contentId: string, initialStatus: string }`
   - State:
     - `currentStatus` (initialized from `initialStatus`)
     - `showRejectForm` (boolean, default false)
     - `isLoading` (boolean, default false)
     - `error` (string | null, default null)
   - Computed: `isPending = currentStatus === 'pending'`

   **handleApprove:**
   - Set isLoading=true, error=null
   - Optimistic update: set currentStatus='approved' immediately
   - `fetch(\`/api/contents/${contentId}/approve\`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({}) })`
   - On success: call `router.refresh()` to revalidate server data
   - On error: revert currentStatus to 'pending', set error message
   - Finally: set isLoading=false

   **handleReject(reason: string):**
   - Set isLoading=true, error=null
   - Optimistic update: set currentStatus='rejected' immediately
   - `fetch(\`/api/contents/${contentId}/reject\`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ reason }) })`
   - On success: setShowRejectForm(false), call `router.refresh()`
   - On error: revert currentStatus to 'pending', set error message
   - Finally: set isLoading=false

   **Render:**
   - Use StickyActionBar as wrapper
   - Left side: Back button (← Back to list, uses `router.push('/contents')`)
   - Center/right: ContentStatusBadge showing `currentStatus`
   - Right side (only when isPending):
     - "Approve" button (variant default, green-toned via className `bg-green-600 hover:bg-green-700`). Shows loader icon when isLoading. Disabled when isLoading or !isPending.
     - "Reject" button (variant destructive outline). Disabled when isLoading or !isPending. Toggles showRejectForm.
   - When !isPending: buttons are hidden or replaced with a text like "This content has been {status}"
   - Error display: if error is set, show a red alert below the bar
   - Below sticky bar: if showRejectForm, render `<RejectForm onConfirm={handleReject} onCancel={() => setShowRejectForm(false)} isLoading={isLoading} />`

4. Update `admin/src/app/contents/[id]/page.tsx`:
   - Import `ActionBar` from `./actions`
   - Add `<ActionBar contentId={content.id} initialStatus={content.status} />` at the top of the page, BEFORE the content preview area
   - The ActionBar is a Client Component rendered inside the Server Component shell -- this is the standard App Router pattern for mixing server data with client interactivity
   - Move the "← Back to list" link from the current page into the ActionBar (remove duplicate)
  </action>
  <verify>cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && pnpm build 2>&1 | tail -20</verify>
  <done>Sticky action bar renders on detail page with Back, status badge, Approve/Reject buttons. Approve sends POST and updates badge optimistically. Reject expands inline textarea, Confirm sends POST with reason. Buttons disable after action.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full admin dashboard: content list page with tabbed filters and pagination, content detail page with magazine-style block preview, and approve/reject workflow with sticky action bar and optimistic UI.</what-built>
  <how-to-verify>
1. Start the FastAPI backend: `cd /Users/kiyeol/development/decoded/editorial-ai-worker && uv run uvicorn editorial_ai.api.app:app --reload --port 8000`
2. Start the Next.js dev server: `cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && pnpm dev`
3. Open http://localhost:3000 in browser -- should redirect to /contents
4. Verify the content list:
   - Table shows content items with title, status badge, keyword, created date
   - Tab filters work (All, Pending, Approved, Rejected) and URL changes
   - Pagination Previous/Next buttons work
5. Click a content row to navigate to /contents/[id]
6. Verify the detail page:
   - Sticky top bar with Back button, status badge, Approve/Reject buttons
   - Magazine-style preview renders blocks (hero, headline, body text, etc.)
   - Images show colored placeholder boxes
   - Raw JSON panel toggles open/closed
7. Test approve flow:
   - Click Approve on a pending content
   - Status badge should update immediately (optimistic)
   - Button should show loading state then disable
8. Test reject flow:
   - Navigate to another pending content
   - Click Reject → textarea expands inline
   - Type a reason → click Confirm Reject
   - Status updates to Rejected, buttons disable
  </how-to-verify>
  <resume-signal>Type "approved" if dashboard works correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- `cd admin && pnpm build` completes without errors
- All action components are Client Components (`'use client'` directive present)
- Approve button sends POST to `/api/contents/{id}/approve` with JSON body
- Reject button sends POST to `/api/contents/{id}/reject` with `{ reason: "..." }` body
- Status badge updates optimistically before API response
- Buttons are disabled for non-pending content
- Sticky bar stays visible while scrolling
</verification>

<success_criteria>
- Sticky action bar on detail page with Back, status badge, Approve, Reject
- Approve: single click, loading spinner, optimistic status update, button disabled after
- Reject: inline textarea expansion, Cancel/Confirm, reason required, optimistic update
- Error handling: API failure reverts optimistic update, shows error message
- Non-pending content: action buttons hidden/disabled
- Full dashboard verified by human in browser
</success_criteria>

<output>
After completion, create `.planning/phases/08-admin-dashboard-ui/08-03-SUMMARY.md`
</output>
