---
phase: 08-admin-dashboard-ui
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - admin/src/app/contents/page.tsx
  - admin/src/app/contents/[id]/page.tsx
  - admin/src/components/content-table.tsx
  - admin/src/components/content-status-badge.tsx
  - admin/src/components/block-renderer.tsx
  - admin/src/components/blocks/hero-block.tsx
  - admin/src/components/blocks/headline-block.tsx
  - admin/src/components/blocks/body-text-block.tsx
  - admin/src/components/blocks/image-gallery-block.tsx
  - admin/src/components/blocks/pull-quote-block.tsx
  - admin/src/components/blocks/product-showcase-block.tsx
  - admin/src/components/blocks/celeb-feature-block.tsx
  - admin/src/components/blocks/divider-block.tsx
  - admin/src/components/blocks/hashtag-bar-block.tsx
  - admin/src/components/blocks/credits-block.tsx
  - admin/src/components/json-panel.tsx
autonomous: true

must_haves:
  truths:
    - "Visiting /contents shows a table of content items with title, status, created date, and keyword columns"
    - "Tab filters (All, Pending, Approved, Rejected) filter the table and update the URL search params"
    - "Clicking a table row navigates to /contents/[id] detail page"
    - "Detail page renders Magazine Layout JSON blocks as high-fidelity preview components"
    - "Image blocks show colored placeholder boxes with type labels"
    - "Collapsible raw JSON panel shows the full layout_json for debugging"
    - "Pagination (Previous/Next) at bottom of table works and updates URL"
  artifacts:
    - path: "admin/src/app/contents/page.tsx"
      provides: "Content list page (Server Component)"
      contains: "ContentsPage"
    - path: "admin/src/app/contents/[id]/page.tsx"
      provides: "Content detail page with block preview"
      contains: "ContentDetailPage"
    - path: "admin/src/components/content-table.tsx"
      provides: "Data table with tabs, pagination, status badges"
      contains: "ContentTable"
    - path: "admin/src/components/block-renderer.tsx"
      provides: "Dispatcher mapping block type to React component"
      contains: "BlockRenderer"
    - path: "admin/src/components/json-panel.tsx"
      provides: "Collapsible raw JSON viewer"
      contains: "JsonPanel"
  key_links:
    - from: "admin/src/app/contents/page.tsx"
      to: "admin/src/app/api/contents/route.ts"
      via: "Server-side fetch to own BFF proxy"
      pattern: "fetch.*api/contents"
    - from: "admin/src/app/contents/[id]/page.tsx"
      to: "admin/src/app/api/contents/[id]/route.ts"
      via: "Server-side fetch to own BFF proxy"
      pattern: "fetch.*api/contents"
    - from: "admin/src/components/block-renderer.tsx"
      to: "admin/src/components/blocks/"
      via: "BLOCK_MAP dispatcher record"
      pattern: "BLOCK_MAP"
    - from: "admin/src/components/content-table.tsx"
      to: "admin/src/app/contents/[id]/page.tsx"
      via: "Row click navigates to detail page"
      pattern: "router.push.*contents/"
---

<objective>
Build the content list page and detail preview page -- the two read-only views of the admin dashboard.

Purpose: These pages are the core of the dashboard. The list page lets the admin browse all content with filtering and pagination. The detail page renders the Magazine Layout JSON as a high-fidelity preview so the admin can evaluate content quality before approving or rejecting.
Output: /contents list page with table + tabs + pagination, /contents/[id] detail page with block preview + JSON panel
</objective>

<execution_context>
@/Users/kiyeol/.claude-pers/get-shit-done/workflows/execute-plan.md
@/Users/kiyeol/.claude-pers/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-admin-dashboard-ui/08-RESEARCH.md
@.planning/phases/08-admin-dashboard-ui/08-01-SUMMARY.md

@admin/src/lib/types.ts
@admin/src/lib/api.ts
@admin/src/lib/utils.ts
@admin/src/config.ts
@src/editorial_ai/models/layout.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Content list page with table, tabs, and pagination</name>
  <files>
    admin/src/app/contents/page.tsx
    admin/src/components/content-table.tsx
    admin/src/components/content-status-badge.tsx
  </files>
  <action>
1. Create `admin/src/components/content-status-badge.tsx`:
   - Map status strings to shadcn Badge variants with appropriate colors:
     - `pending` → variant "secondary" (amber-toned), label "Pending"
     - `approved` → variant "default" (green-toned), label "Approved"
     - `rejected` → variant "destructive", label "Rejected"
     - `published` → variant "outline", label "Published"
   - Use custom className overrides for specific colors (e.g., `bg-amber-100 text-amber-800` for pending, `bg-green-100 text-green-800` for approved)
   - Handle unknown status gracefully with outline variant

2. Create `admin/src/components/content-table.tsx` as a Client Component (`'use client'`):
   - Props: `{ items: ContentItem[], total: number, page: number, limit: number, currentStatus?: string }`
   - **Tab filters** at top using shadcn Tabs component:
     - Tabs: All | Pending | Approved | Rejected
     - Each tab shows a badge count. Counts come from the `total` prop (since server filters by status, total reflects the filtered count). For "All" tab show total when no status filter.
     - Tab click uses `router.push('/contents?status=pending&page=1')` to update URL. "All" tab omits the status param.
     - Active tab is determined from `currentStatus` prop
   - **Data table** using @tanstack/react-table + shadcn Table:
     - Columns: Title (main text, truncated to ~60 chars), Status (ContentStatusBadge), Keyword (secondary text), Created (formatted date using formatDate from utils)
     - Row click: `router.push(\`/contents/${item.id}\`)` -- entire row is clickable with hover:bg-muted cursor-pointer
     - Default sort: by created_at descending (client-side via tanstack)
     - Column headers are clickable for client-side sorting
   - **Pagination** at bottom:
     - Show "Showing X-Y of Z" text
     - Previous / Next buttons (disabled at boundaries)
     - Buttons use `router.push('/contents?status=...&page=N')` to change page
   - Empty state: centered message "No content found" when items is empty

3. Create `admin/src/app/contents/page.tsx` as a Server Component:
   - Read `searchParams` (it's a Promise in Next.js 15 -- use `const params = await searchParams`)
   - Extract `status` (optional) and `page` (default 1) from params
   - Calculate `limit = 20` and `offset = (page - 1) * limit`
   - Fetch from own BFF proxy: `fetch(\`${process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'}/api/contents?...\`, { cache: 'no-store' })`
   - IMPORTANT: Add `export const dynamic = 'force-dynamic'` to prevent build-time pre-rendering (fetch to own server fails at build time)
   - Pass data to `<ContentTable items={data.items} total={data.total} page={page} limit={limit} currentStatus={status} />`
   - Wrap in try/catch: on fetch error, show a centered error card with "Failed to load contents" and a retry link
  </action>
  <verify>cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && pnpm build 2>&1 | tail -20</verify>
  <done>Content list page renders at /contents with tabbed filters, sortable data table, pagination, and status badges. URL search params drive filtering and pagination.</done>
</task>

<task type="auto">
  <name>Task 2: Block renderer components and detail page</name>
  <files>
    admin/src/components/block-renderer.tsx
    admin/src/components/blocks/hero-block.tsx
    admin/src/components/blocks/headline-block.tsx
    admin/src/components/blocks/body-text-block.tsx
    admin/src/components/blocks/image-gallery-block.tsx
    admin/src/components/blocks/pull-quote-block.tsx
    admin/src/components/blocks/product-showcase-block.tsx
    admin/src/components/blocks/celeb-feature-block.tsx
    admin/src/components/blocks/divider-block.tsx
    admin/src/components/blocks/hashtag-bar-block.tsx
    admin/src/components/blocks/credits-block.tsx
    admin/src/components/json-panel.tsx
    admin/src/app/contents/[id]/page.tsx
  </files>
  <action>
1. Create all 10 block components in `admin/src/components/blocks/`. Each is a simple React component that receives a typed `block` prop and renders magazine-style preview. Use Tailwind classes for styling. All images show colored placeholder boxes.

   **hero-block.tsx**: Full-width 16:9 aspect ratio container, `bg-slate-200` placeholder with "Hero Image" label centered. If `overlay_title` exists, overlay it with semi-transparent black backdrop, large white bold text. If `overlay_subtitle`, smaller white text below.

   **headline-block.tsx**: Render `text` as heading. Map `level` to element: 1 → `<h1>` (text-4xl font-bold font-serif), 2 → `<h2>` (text-3xl font-semibold font-serif), 3 → `<h3>` (text-2xl font-medium font-serif). Use Georgia or serif font-family for editorial feel.

   **body-text-block.tsx**: Map `paragraphs` array to `<p>` elements. Each paragraph gets `text-base leading-relaxed text-gray-700` and `mb-4` spacing. Use sans-serif (default). Handle empty array gracefully.

   **image-gallery-block.tsx**: Render `images` array as a grid. Use `layout_style` to determine grid: "grid" → 2-column grid, "carousel" → horizontal flex with overflow-x-auto, "masonry" → CSS columns. Each image is a placeholder box (`bg-slate-200 aspect-square rounded`) with alt text or "Image" label. Show caption below if present.

   **pull-quote-block.tsx**: Large italic serif text with left border accent (`border-l-4 border-primary pl-6`). Quote text in `text-xl italic font-serif text-gray-800`. Attribution below in smaller `text-sm text-gray-500` with em-dash prefix if present.

   **product-showcase-block.tsx**: Grid of product cards (2-3 columns). Each card: placeholder image box (`bg-blue-100`, label "Product Photo"), product name in bold, brand in muted text, description in small text. Use shadcn Card component for each product.

   **celeb-feature-block.tsx**: Grid of celeb cards (2-3 columns). Each card: circular placeholder image (`bg-purple-100 rounded-full aspect-square`), celeb name in bold, description below. Similar to product but with circular image.

   **divider-block.tsx**: Map `style`: "line" → `<hr>` with border-gray-200, "space" → `<div className="h-8">`, "ornament" → centered decorative character (e.g., "***" or "---" with special styling).

   **hashtag-bar-block.tsx**: Horizontal flex wrap of hashtag pills. Each hashtag: `bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm`. Prefix with "#" if not already present.

   **credits-block.tsx**: Simple list of role/name pairs. Each entry: `<div>` with role in `text-xs uppercase tracking-wider text-gray-400` and name in `text-sm text-gray-600`. Use a clean layout (flex or grid).

   CRITICAL for all blocks: Use defensive rendering with optional chaining (`?.`) and fallback values. AI-generated layout JSON may have missing fields. Never crash on undefined.

2. Create `admin/src/components/block-renderer.tsx`:
   - Import all 10 block components
   - Create `BLOCK_MAP: Record<string, React.ComponentType<{ block: any }>>` mapping type string to component
   - `BlockRenderer({ blocks }: { blocks: LayoutBlock[] })` maps over blocks, looks up component in BLOCK_MAP
   - Unknown block types: render a warning box with dashed orange border showing "Unknown block type: {type}"
   - Wrap in `<article className="max-w-3xl mx-auto space-y-8 py-8">`

3. Create `admin/src/components/json-panel.tsx` as a Client Component (`'use client'`):
   - Collapsible panel using `useState` for open/close toggle
   - Button shows "Raw JSON ▸" when collapsed, "Raw JSON ▾" when expanded
   - Expanded state: `<pre>` with dark background (`bg-slate-950 text-slate-100`), monospace font, `max-h-96 overflow-auto`, formatted with `JSON.stringify(data, null, 2)`
   - Wrap in a border rounded container

4. Create `admin/src/app/contents/[id]/page.tsx` as a Server Component:
   - Read `params` (Promise in Next.js 15 -- use `const { id } = await params`)
   - Add `export const dynamic = 'force-dynamic'`
   - Fetch content detail from BFF proxy: `fetch(\`${process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'}/api/contents/${id}\`, { cache: 'no-store' })`
   - On 404: use `notFound()` from `next/navigation`
   - Render page layout:
     - Top section: Back link (← Back to list, links to /contents), title in large text, status badge, keyword, dates
     - Content metadata: review_summary (if present), rejection_reason (if present, in red alert box), admin_feedback (if present)
     - Magazine preview section: `<BlockRenderer blocks={content.layout_json.blocks} />`
     - Below preview: `<JsonPanel data={content.layout_json} />`
   - NOTE: This page does NOT include approve/reject buttons yet -- that's Plan 03. Just render the read-only preview.
  </action>
  <verify>cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && pnpm build 2>&1 | tail -20</verify>
  <done>10 block components render magazine-style preview, BlockRenderer dispatches by type, detail page at /contents/[id] shows full content preview with metadata and JSON panel, list page links to detail pages</done>
</task>

</tasks>

<verification>
- `cd admin && pnpm build` completes without errors
- All 10 block component files exist in `admin/src/components/blocks/`
- `admin/src/components/block-renderer.tsx` imports and maps all 10 block types
- `admin/src/app/contents/page.tsx` is a Server Component that fetches from BFF proxy
- `admin/src/app/contents/[id]/page.tsx` renders block preview and JSON panel
- No `'use client'` on Server Components (contents/page.tsx and contents/[id]/page.tsx)
- `'use client'` on interactive components (content-table.tsx, json-panel.tsx)
</verification>

<success_criteria>
- Content list page shows data table with title, status badge, keyword, and created date columns
- Tab filters change URL params and re-fetch filtered data
- Pagination works with Previous/Next buttons
- Detail page renders all 10 block types as styled components
- Images show colored placeholder boxes with labels
- Raw JSON panel toggles open/closed
- Unknown block types show a warning instead of crashing
- All pages build without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-admin-dashboard-ui/08-02-SUMMARY.md`
</output>
