---
phase: 08-admin-dashboard-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - admin/package.json
  - admin/next.config.ts
  - admin/tsconfig.json
  - admin/tailwind.config.ts
  - admin/components.json
  - admin/src/app/layout.tsx
  - admin/src/app/page.tsx
  - admin/src/lib/types.ts
  - admin/src/lib/api.ts
  - admin/src/lib/utils.ts
  - admin/src/config.ts
  - admin/src/app/api/contents/route.ts
  - admin/src/app/api/contents/[id]/route.ts
  - admin/src/app/api/contents/[id]/approve/route.ts
  - admin/src/app/api/contents/[id]/reject/route.ts
  - admin/.env.local.example
autonomous: true

must_haves:
  truths:
    - "Next.js 15 dev server starts without errors on port 3000"
    - "shadcn/ui components (table, tabs, badge, button, textarea, skeleton, card, separator) are installed and importable"
    - "TypeScript types mirror the FastAPI ContentResponse and MagazineLayout schemas exactly"
    - "BFF proxy routes forward requests to FastAPI backend with X-API-Key header injected server-side"
    - "Root page redirects to /contents"
  artifacts:
    - path: "admin/src/lib/types.ts"
      provides: "TypeScript types for ContentItem, ContentListResponse, MagazineLayout, all 10 LayoutBlock types"
      contains: "ContentItem"
    - path: "admin/src/lib/api.ts"
      provides: "Fetch wrapper with apiGet and apiPost helpers"
      exports: ["apiGet", "apiPost"]
    - path: "admin/src/app/api/contents/route.ts"
      provides: "BFF proxy for GET /api/contents (list with status/limit/offset params)"
      contains: "X-API-Key"
    - path: "admin/src/app/api/contents/[id]/route.ts"
      provides: "BFF proxy for GET /api/contents/{id} (detail)"
      contains: "X-API-Key"
    - path: "admin/src/app/api/contents/[id]/approve/route.ts"
      provides: "BFF proxy for POST /api/contents/{id}/approve"
      contains: "X-API-Key"
    - path: "admin/src/app/api/contents/[id]/reject/route.ts"
      provides: "BFF proxy for POST /api/contents/{id}/reject"
      contains: "X-API-Key"
    - path: "admin/src/config.ts"
      provides: "Environment variable configuration (API_BASE_URL, ADMIN_API_KEY)"
  key_links:
    - from: "admin/src/app/api/contents/route.ts"
      to: "admin/src/config.ts"
      via: "imports API_BASE_URL and ADMIN_API_KEY"
      pattern: "import.*config"
    - from: "admin/src/lib/types.ts"
      to: "src/editorial_ai/api/schemas.py"
      via: "mirrors ContentResponse and MagazineLayout schemas"
      pattern: "ContentItem"
---

<objective>
Scaffold the Next.js 15 admin dashboard project and set up the foundational infrastructure.

Purpose: Establish the project skeleton that all subsequent plans build on -- Next.js App Router with shadcn/ui, TypeScript types mirroring the FastAPI backend, BFF proxy routes that hide the API key from the browser, and shared utilities.
Output: Working Next.js dev server with shadcn/ui, TypeScript types, BFF proxy routes, root layout
</objective>

<execution_context>
@/Users/kiyeol/.claude-pers/get-shit-done/workflows/execute-plan.md
@/Users/kiyeol/.claude-pers/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-admin-dashboard-ui/08-RESEARCH.md

@src/editorial_ai/api/schemas.py
@src/editorial_ai/models/layout.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js 15 project with shadcn/ui</name>
  <files>
    admin/package.json
    admin/next.config.ts
    admin/tsconfig.json
    admin/components.json
    admin/src/app/layout.tsx
    admin/.env.local.example
  </files>
  <action>
1. From project root, create the Next.js 15 project:
   ```bash
   cd /Users/kiyeol/development/decoded/editorial-ai-worker
   pnpm create next-app@15 admin --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --yes
   ```

2. Pin Next.js 15 explicitly (create-next-app may install latest):
   ```bash
   cd admin && pnpm add next@15 react@19 react-dom@19
   ```

3. Initialize shadcn/ui:
   ```bash
   pnpm dlx shadcn@latest init --defaults
   ```
   If prompted for style, use "new-york" (cleaner for admin UIs). Accept defaults for everything else.

4. Add required shadcn components:
   ```bash
   pnpm dlx shadcn@latest add table tabs badge button textarea skeleton card separator
   ```

5. Add supporting dependencies:
   ```bash
   pnpm add @tanstack/react-table date-fns
   ```

6. Create `admin/.env.local.example` with:
   ```
   # FastAPI backend URL (default: http://localhost:8000)
   API_BASE_URL=http://localhost:8000

   # Admin API key (leave empty for dev-mode bypass)
   ADMIN_API_KEY=

   # Next.js public base URL (for Server Component self-fetch)
   NEXT_PUBLIC_BASE_URL=http://localhost:3000
   ```

7. Update `admin/src/app/layout.tsx` to use a clean admin layout:
   - Set page title to "Editorial Admin"
   - Add a minimal top-level header: "Editorial Admin" text on the left
   - Use Geist font (default from Next.js create) for sans-serif, keep clean professional look
   - Body wrapper with `min-h-screen bg-background` class

8. Update `admin/src/app/page.tsx` to redirect to `/contents`:
   - Use `redirect('/contents')` from `next/navigation`
   - This is a Server Component, so `redirect()` works directly
  </action>
  <verify>cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && pnpm build 2>&1 | tail -20</verify>
  <done>Next.js 15 project exists at admin/, shadcn/ui components installed, dev server builds without errors, root page redirects to /contents</done>
</task>

<task type="auto">
  <name>Task 2: TypeScript types, config, API client, and BFF proxy routes</name>
  <files>
    admin/src/lib/types.ts
    admin/src/lib/api.ts
    admin/src/lib/utils.ts
    admin/src/config.ts
    admin/src/app/api/contents/route.ts
    admin/src/app/api/contents/[id]/route.ts
    admin/src/app/api/contents/[id]/approve/route.ts
    admin/src/app/api/contents/[id]/reject/route.ts
  </files>
  <action>
1. Create `admin/src/config.ts`:
   ```typescript
   export const API_BASE_URL = process.env.API_BASE_URL || 'http://localhost:8000';
   export const ADMIN_API_KEY = process.env.ADMIN_API_KEY || '';
   ```

2. Create `admin/src/lib/types.ts` -- mirror the FastAPI schemas exactly. Reference `src/editorial_ai/api/schemas.py` and `src/editorial_ai/models/layout.py`:

   Types needed (copy structure from 08-RESEARCH.md Code Examples section):
   - `ContentItem` -- mirrors ContentResponse (id, thread_id, status, title, keyword, layout_json as MagazineLayout, review_summary, rejection_reason, admin_feedback, created_at, updated_at, published_at)
   - `ContentListResponse` -- { items: ContentItem[], total: number }
   - `MagazineLayout` -- { schema_version, title, subtitle?, keyword, blocks, created_at?, metadata? }
   - All 10 block types as discriminated union: HeroBlock, HeadlineBlock, BodyTextBlock, ImageGalleryBlock, PullQuoteBlock, ProductShowcaseBlock, CelebFeatureBlock, DividerBlock, HashtagBarBlock, CreditsBlock
   - Supporting types: ImageItem, ProductItem, CelebItem, CreditEntry
   - `LayoutBlock` union type of all 10 blocks
   - `ApproveRequest` -- { feedback?: string }
   - `RejectRequest` -- { reason: string }

   IMPORTANT: Match field names exactly to the Python models. E.g., `layout_style` not `layoutStyle` (the API returns snake_case JSON).

3. Ensure `admin/src/lib/utils.ts` has the `cn()` utility (shadcn init creates this). Add a date formatter:
   ```typescript
   import { format } from 'date-fns';

   export function formatDate(dateString: string): string {
     return format(new Date(dateString), 'yyyy-MM-dd HH:mm');
   }
   ```
   Append to existing utils.ts (don't overwrite cn()).

4. Create `admin/src/lib/api.ts`:
   - `apiGet<T>(path: string, params?: Record<string, string>): Promise<T>` -- fetches from NEXT_PUBLIC_BASE_URL + path with no-store cache, throws on non-ok
   - `apiPost<T>(path: string, body?: unknown): Promise<T>` -- POST with JSON body to NEXT_PUBLIC_BASE_URL + path, throws on non-ok
   - Use `process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'` as base

5. Create BFF proxy routes. All routes follow the same pattern:
   - Import `API_BASE_URL` and `ADMIN_API_KEY` from `@/config`
   - Forward request to FastAPI backend at API_BASE_URL
   - Inject `X-API-Key: ${ADMIN_API_KEY}` header
   - Use `cache: 'no-store'` on all fetches (admin dashboard needs fresh data)
   - Return `NextResponse.json(data, { status: res.status })` on success
   - On upstream error, return the error status and body

   **`admin/src/app/api/contents/route.ts`** -- GET handler:
   - Forward query params (status, limit, offset) to `${API_BASE_URL}/api/contents`

   **`admin/src/app/api/contents/[id]/route.ts`** -- GET handler:
   - Extract `id` from route params
   - Forward to `${API_BASE_URL}/api/contents/${id}`

   **`admin/src/app/api/contents/[id]/approve/route.ts`** -- POST handler:
   - Extract `id` from route params
   - Read JSON body from request
   - Forward to `${API_BASE_URL}/api/contents/${id}/approve`
   - Include request body in forwarded POST

   **`admin/src/app/api/contents/[id]/reject/route.ts`** -- POST handler:
   - Extract `id` from route params
   - Read JSON body from request
   - Forward to `${API_BASE_URL}/api/contents/${id}/reject`
   - Include request body in forwarded POST

   NOTE on Next.js 15 route params: In App Router, `params` is a Promise. Use `const { id } = await params;` pattern.
  </action>
  <verify>cd /Users/kiyeol/development/decoded/editorial-ai-worker/admin && pnpm build 2>&1 | tail -20</verify>
  <done>TypeScript types exist and match FastAPI schemas, config exports env vars, api.ts provides fetch wrappers, all 4 BFF proxy routes build without type errors</done>
</task>

</tasks>

<verification>
- `cd admin && pnpm build` completes without errors
- `cd admin && pnpm dev` starts dev server on port 3000
- Visiting http://localhost:3000 redirects to /contents (will 404 since page doesn't exist yet -- that's expected)
- `admin/src/lib/types.ts` contains all 10 block types + ContentItem + ContentListResponse
- All 4 BFF proxy route files exist under `admin/src/app/api/`
- shadcn components exist in `admin/src/components/ui/` (table, tabs, badge, button, textarea, skeleton, card, separator)
</verification>

<success_criteria>
- Next.js 15 project builds cleanly at admin/
- shadcn/ui initialized with all required components
- TypeScript types mirror FastAPI schemas (ContentItem, MagazineLayout, all 10 LayoutBlock types)
- BFF proxy routes forward to FastAPI with X-API-Key injection
- Root page redirects to /contents
- API client (apiGet, apiPost) is available for use by subsequent plans
</success_criteria>

<output>
After completion, create `.planning/phases/08-admin-dashboard-ui/08-01-SUMMARY.md`
</output>
