# Milestone v1.1: 파이프라인 실행 검증 + 관측성 + 매거진 렌더러

**Status:** ✅ SHIPPED 2026-02-26
**Phases:** 9-13
**Total Plans:** 16

## Overview

v1.0 파이프라인을 실제 환경에서 실행 검증하고, 노드별 상세 로그를 수집하여 Admin에 표시하며, Layout JSON을 실제 매거진 형태로 렌더링한다. 추가로 모델 라우팅, 컨텍스트 캐싱, 적응형 루브릭으로 파이프라인을 고도화한다.

## Phases

### Phase 9: E2E Execution Foundation

**Goal**: Admin UI에서 키워드를 입력하면 파이프라인이 실제 Gemini + Supabase 환경에서 처음부터 끝까지 정상 실행되는 상태
**Depends on**: Phase 8 (v1.0 complete)
**Plans**: 3 plans

Plans:
- [x] 09-01: Backend prerequisites (seed_keyword fix, env validation, rich health check)
- [x] 09-02: Sample data SQL seed script (posts, spots, solutions, celebs, products)
- [x] 09-03: Content creation trigger UI (modal, progress polling, pipeline status endpoint)

**Details:**
- Requirements: E2E-01, E2E-02, E2E-03, E2E-04, E2E-05
- seed_keyword with keyword fallback for backward compatibility
- Non-blocking pipeline trigger via asyncio.create_task
- BFF proxy pattern for API key hiding; 3s polling with 180s timeout

### Phase 10: Pipeline Observability Backend

**Goal**: 파이프라인 실행 시 각 노드의 토큰 사용량, 처리 시간, 상태가 자동 수집되어 API로 조회 가능한 상태
**Depends on**: Phase 9
**Plans**: 3 plans

Plans:
- [x] 10-01: Observability models, token collector context var, JSONL storage
- [x] 10-02: Node wrapper decorator, service layer token injection, graph wiring
- [x] 10-03: Logs API endpoint (GET /api/contents/{id}/logs)

**Details:**
- Requirements: OBS-01, OBS-02, OBS-03
- ContextVar copy-on-first-write for cross-context safety
- Fire-and-forget pattern for all observability I/O
- 10 LLM call sites instrumented
- Node wrapping applied after node_overrides so test stubs also get wrapped

### Phase 11: Magazine Renderer Enhancement

**Goal**: Admin 상세 페이지의 매거진 프리뷰가 실제 이미지, 에디토리얼 타이포그래피, 에러 복원력을 갖춘 매거진 품질로 렌더링되는 상태
**Depends on**: Phase 8 (existing block components)
**Plans**: 4 plans

Plans:
- [x] 11-01: DesignSpec pipeline node (Pydantic model, Gemini service, graph wiring)
- [x] 11-02: MagazineImage + BlockErrorBoundary (progressive loading, gradient fallback, per-block error isolation)
- [x] 11-03: Block components upgrade (10 blocks: real images, magazine typography, Google Fonts, design spec)
- [x] 11-04: Detail page tab integration (Magazine/JSON tabs, DesignSpec context provider)

**Details:**
- Requirements: MAG-01, MAG-02, MAG-03, MAG-04
- Native <img> over next/image for arbitrary external URLs
- Google Fonts via next/font/google CSS variables
- Drop cap with float-left Playfair Display serif

### Phase 12: Observability Dashboard

**Goal**: Admin 대시보드에서 파이프라인 실행 과정을 시각적으로 추적하고 비용을 파악할 수 있는 상태
**Depends on**: Phase 10, Phase 11
**Plans**: 3 plans

Plans:
- [x] 12-01: BFF proxy route, TypeScript types, cost/duration utilities
- [x] 12-02: Pipeline tab (Gantt timeline, node detail, cost summary, ContentTabs wiring)
- [x] 12-03: List page pipeline status column (BFF enrichment, step indicator, summary metrics)

**Details:**
- Requirements: OBS-04, OBS-05, OBS-06
- Round grouping by detecting repeated node_name for retry visualization
- IO data lazy-loaded on demand to avoid heavy initial page load
- BFF list proxy enriches items server-side via Promise.all parallel log fetches

### Phase 13: Pipeline Advanced

**Goal**: 파이프라인이 작업 복잡도에 따라 모델을 자동 선택하고, 반복 참조 소스를 캐싱하며, 콘텐츠 유형별 평가 기준을 동적 조정하는 상태
**Depends on**: Phase 9, Phase 10
**Plans**: 3 plans

Plans:
- [x] 13-01: Config-driven model router (YAML config, Flash-Lite/Flash/Pro routing, observability logging)
- [x] 13-02: Adaptive review rubrics (content type classifier, rubric registry, dynamic review prompt)
- [x] 13-03: Context caching for retry paths (CacheManager, review/editorial cache on retry, cached token tracking)

**Details:**
- Requirements: ADV-01, ADV-02, ADV-03
- YAML config over code constants for model mapping
- Module-level singleton ModelRouter
- revision_count >= 2 triggers Pro upgrade
- MIN_CACHE_TOKENS=2048, TTL 3600s

---

## Milestone Summary

**Key Decisions:**
- E2E 실행 검증 최우선, 관측성 백엔드 → 대시보드 순서
- 관측성은 LangChain callbacks가 아닌 커스텀 node_wrapper 패턴 (google-genai SDK 직접 사용)
- 매거진 렌더러는 기존 10개 블록 컴포넌트 업그레이드 (새 아키텍처 아님)
- YAML config-driven model routing for easy tuning without deploys
- Fire-and-forget for all observability and caching I/O

**Issues Resolved:**
- seed_keyword vs keyword 필드명 불일치 해결 (Phase 9)
- google-genai response.usage_metadata 필드명 검증 완료 (Phase 10)

**Issues Deferred:**
- OBS-06 partial: in-flight pipeline status (큐레이션 중/리뷰 중) — DB stores terminal states only
- MAG-04 partial: tabs instead of side-by-side (deliberate design decision)

**Technical Debt Incurred:**
- review_node reads 'keyword' instead of 'seed_keyword' — adaptive rubrics silently degrade for non-fashion content
- routing_reason + cached_tokens not exposed in API response — Phase 13 observability invisible in UI
- DesignSpecProvider context created but not consumed by block components
- Orphaned json-panel.tsx component (dead code)
- PipelineStatusIndicator returns null for unknown status keys

---

_For current project status, see .planning/ROADMAP.md_
